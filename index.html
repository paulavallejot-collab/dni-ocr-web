<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VerificaciÃ³n DNI por OCR (MRZ)</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>VerificaciÃ³n por OCR (MRZ) Â· DNI</h1>
    <p>
      Enfoca el reverso del DNI (banda MRZ, 3 lÃ­neas con &lt;). Captura â†’ preprocesado â†’ OCR â†’ validaciÃ³n MRZ â†’ cotejo.
    </p>
  </header>

  <main>
    <section class="camera">
      <div class="camera__view">
        <div class="camera__overlay">
          <div class="mrz-frame">
            <span class="mrz-hint">Coloca la banda MRZ aquÃ­</span>
          </div>
        </div>
        <video id="video" playsinline autoplay muted></video>
        <div class="controls">
          <button id="startCamBtn">ðŸ“· Activar cÃ¡mara</button>
          <button id="captureBtn" disabled>ðŸŽ¯ Capturar</button>
          <button id="stopCamBtn" disabled>âœ‹ Apagar</button>
        </div>
      </div>
      <!-- Canvas de captura y preprocesado -->
      <canvas id="canvas" width="960" height="540" hidden></canvas>
      <canvas id="procCanvas" width="960" height="540" hidden></canvas>
      <div class="preview">
        <img id="snapshot" alt="Captura" />
      </div>
    </section>

    <section class="ocr">
      <h2>Resultado OCR</h2>
      <pre id="ocrRaw"></pre>
      <div class="parsed">
        <div><strong>DNI detectado:</strong> <span id="dniValue">â€”</span></div>
        <div><strong>Apellidos detectados:</strong> <span id="surnamesValue">â€”</span></div>
        <div><strong>Nombre detectado:</strong> <span id="namesValue">â€”</span></div>
        <div id="dniStatus" class="hint"></div>
      </div>

      <div id="alertBox" class="alert" role="alert" aria-live="assertive">
        <svg id="alertIcon" class="alert__icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M1 21h22L12 2 1 21z"></path>
          <path d="M12 16a1 1 0 110 2 1 1 0 010-2zm-1-7h2v5h-2z"></path>
        </svg>
        <div class="alert__content">
          <strong id="alertTitle">Estado MRZ</strong>
          <div id="alertText" class="alert__text">Esperando capturaâ€¦</div>
        </div>
      </div>
    </section>

    <section class="results">
      <h2>Coincidencias en Convocatoria</h2>
      <table id="resultsTable">
        <thead>
          <tr>
            <th>Nombre</th><th>Apellido</th><th>DNI</th><th>Estado</th><th>AcciÃ³n</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="actions">
        <button id="exportLogBtn">â¬‡ Exportar validados (CSV)</button>
        <button id="exportIncBtn">â¬‡ Exportar incidencias (CSV)</button>
        <button id="searchListBtn" disabled aria-disabled="true">ðŸ”Ž Cotejar con listado</button>
        <span id="counts"></span>
      </div>
    </section>
  </main>

  <footer>
    <small>Â© OrganizaciÃ³n Â· RGPD: uso interno, minimizaciÃ³n de datos</small>
  </footer>

  <!-- Tesseract.js (OCR) por CDN -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@6.0.0/dist/tesseract.min.js"></script>
  <!-- Validador MRZ TD1 -->
  <script type="module">
    import { validateMRZfromOCR } from './mrz.js';
    window.validateMRZfromOCR = validateMRZfromOCR;
  </script>
  <script src="app.js"></script>
</body>
</html>
